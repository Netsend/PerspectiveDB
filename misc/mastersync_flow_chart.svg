<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="709px" height="904px" version="1.1"><defs/><g transform="translate(0.5,0.5)"><rect x="125" y="331" width="116" height="90" rx="14" ry="14" fill="#e6ffcc" stroke="#000000" stroke-width="3" pointer-events="none"/><g transform="translate(124,331)"><switch><foreignObject pointer-events="all" width="118" height="92" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.26; vertical-align: top; width: 116px; height: 90px; white-space: nowrap; font-weight: bold; text-align: center;"><p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline"><strong>Privileged<br /></strong></p><hr />MongoDB admin<br />read oplog<br />fork vc's<br /></div></foreignObject><text x="59" y="52" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><rect x="371" y="137" width="110" height="90" rx="14" ry="14" fill="#e6ffcc" stroke="#000000" stroke-width="3" pointer-events="none"/><g transform="translate(370,137)"><switch><foreignObject pointer-events="all" width="112" height="92" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.26; vertical-align: top; width: 110px; height: 90px; white-space: nowrap; font-weight: bold; text-align: center;"><p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline"><strong>Unprivileged</strong></p><hr /><p style="margin: 0px ; margin-left: 8px">chroot</p><p style="margin: 0px ; margin-left: 8px">local db only</p><p style="margin: 0px ; margin-left: 8px">oplog via IPC<br /></p></div></foreignObject><text x="56" y="52" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><path d="M 481 182 L 663 315 Q 671 321 665 329 L 526 505" fill="none" stroke="#990000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 522 509 L 524 500 L 526 505 L 530 505 Z" fill="#990000" stroke="#990000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 183 421 L 182 421 Q 180 421 180 431 L 180 531 Q 180 541 190 541 L 393 541" fill="none" stroke="#990000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 399 541 L 391 545 L 393 541 L 391 537 Z" fill="#990000" stroke="#990000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 241 376 L 411 376 Q 421 376 421 366 L 421 235" fill="none" stroke="#990000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 421 229 L 425 237 L 421 235 L 417 237 Z" fill="#990000" stroke="#990000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><rect x="431" y="311" width="180" height="73" fill="none" stroke="none" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="521" y="324">fork</text><text x="521" y="338">Versioned Collection</text><text x="521" y="352">get oplog reads over ipc and</text><text x="521" y="366">new authenticated remote sockets</text><text x="521" y="380"> over ipc</text></g><rect x="591" y="180" width="100" height="94" fill="none" stroke="none" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="641" y="217">Connect to each</text><text x="641" y="231">locally  configured import</text><text x="641" y="245">with an auth request</text></g><rect x="166" y="501" width="205" height="40" fill="none" stroke="none" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="269" y="514">open chrooted WebSocket</text><text x="269" y="528">(IP or UNIX domain socket)</text></g><rect x="401" y="481" width="120" height="90" rx="14" ry="14" fill="#e6ffcc" stroke="#000000" stroke-width="3" pointer-events="none"/><g transform="translate(400,481)"><switch><foreignObject pointer-events="all" width="122" height="92" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.26; vertical-align: top; width: 120px; height: 90px; white-space: nowrap; font-weight: bold; text-align: center;"><p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline"><strong>Unprivileged</strong></p><hr />WebSocket<br />pre-auth<br /></div></foreignObject><text x="61" y="52" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><path d="M 401 504 L 246 402" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 242 399 L 250 400 L 246 402 L 246 406 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="306" y="421" width="105" height="50" fill="none" stroke="none" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="359" y="450">auth incoming connections</text></g><rect x="326" y="811" width="120" height="90" rx="14" ry="14" fill="#e6ffcc" stroke="#000000" stroke-width="3" pointer-events="none"/><g transform="translate(325,811)"><switch><foreignObject pointer-events="all" width="122" height="92" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.26; vertical-align: top; width: 120px; height: 90px; white-space: nowrap; font-weight: bold; text-align: center;"><p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline"><strong>Client</strong></p><hr />Send auth + pull<br />request<br /></div></foreignObject><text x="61" y="52" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><path d="M 391 811 L 391 701 Q 392 691 402 691 L 451 691 Q 461 691 461 681 L 461 577" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 461 572 L 465 579 L 461 577 L 458 579 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="471" y="631" width="160" height="180" fill="none" stroke="none" pointer-events="none"/><g transform="translate(471,631)"><switch><foreignObject pointer-events="all" width="162" height="182" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.26; vertical-align: top; width: 160px; height: 180px; white-space: nowrap;"><table width="100%" cellpadding="4" border="1" style="width: 100% ; height: 100% ; border-collapse: collapse"><tbody><tr><th align="center"><b>Auth request<br /></b></th></tr><tr><td align="center">database<br />collection<br />offset<br /></td></tr><tr><td align="center">Credentials<br /></td></tr></tbody></table></div></foreignObject><text x="81" y="97" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="1" y="11" width="240" height="270" fill="none" stroke="none" pointer-events="none"/><g transform="translate(6,1)"><switch><foreignObject pointer-events="all" width="232" height="243" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.26; vertical-align: top; overflow: hidden; max-height: 280px; width: 230px; white-space: normal;"><div style="display:inline-block;text-align:inherit;text-decoration:inherit;" xmlns="http://www.w3.org/1999/xhtml"><h1>Mastersync server<br /></h1><p>A privileged daemon is started. This daemon forks a Versioned Collection for each database and collection that is versioned. Furthermore it spawns a process for incoming authentication requests via WebSockets. The IPC between the two is limited to an auth request including a socket. After the connection is authenticated and authorized, the socket is passed to the corresponding versioned collection.<br /></p></div></div></foreignObject><text x="116" y="128" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 212 331 L 366 205" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 370 202 L 367 209 L 366 205 L 362 203 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="251" y="207" width="80" height="40" fill="none" stroke="none" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="291" y="224">pass authenticated</text><text x="291" y="238">websocket</text></g></g></svg>